generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Photographer {
  id             String     @id @default(uuid())
  username       String     @unique
  email          String     @unique
  password       String
  displayName    String?    @map("display_name")
  logoUrl        String?    @map("logo_url")
  facebookUrl    String?    @map("facebook_url")
  instagramUrl   String?    @map("instagram_url")
  twitterUrl     String?    @map("twitter_url")
  websiteUrl     String?    @map("website_url")
  apiKey         String?    @unique @map("api_key")
  storageQuotaMb Int        @default(1000) @map("storage_quota_mb")
  storageUsedMb  Int        @default(0) @map("storage_used_mb")
  isActive       Boolean    @default(true) @map("is_active")
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  apiUsage       ApiUsage[]
  events         Event[]
  photos         Photo[]

  @@map("photographers")
}

model Event {
  id              String       @id @default(uuid())
  photographerId  String       @map("photographer_id")
  eventDate       DateTime     @map("event_date")
  title           String
  subtitle        String?
  description     String?
  folderName      String       @map("folder_name")
  defaultLanguage String       @default("th") @map("default_language")
  isPublished     Boolean      @default(false) @map("is_published")
  slug            String       @unique
  photoCount      Int          @default(0) @map("photo_count")
  totalSizeMb     Int          @default(0) @map("total_size_mb")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")
  photographer    Photographer @relation(fields: [photographerId], references: [id], onDelete: Cascade)
  photos          Photo[]

  @@unique([photographerId, folderName], name: "unique_folder_per_photographer")
  @@map("events")
}

model Photo {
  id               String       @id @default(uuid())
  eventId          String       @map("event_id")
  photographerId   String       @map("photographer_id")
  originalFilename String       @map("original_filename")
  originalPath     String       @map("original_path")
  thumbnailPath    String       @map("thumbnail_path")
  fileSizeBytes    Int          @map("file_size_bytes")
  width            Int?
  height           Int?
  format           String?
  checksum         String?
  shotAt           DateTime?    @map("shot_at")
  uploadedAt       DateTime     @default(now()) @map("uploaded_at")
  event            Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  photographer     Photographer @relation(fields: [photographerId], references: [id], onDelete: Cascade)

  @@index([eventId], map: "photos_event_id_fkey")
  @@index([photographerId], map: "photos_photographer_id_fkey")
  @@map("photos")
}

model ApiUsage {
  id               String       @id @default(uuid())
  photographerId   String       @map("photographer_id")
  endpoint         String
  requestCount     Int          @default(0) @map("request_count")
  bytesTransferred Int          @default(0) @map("bytes_transferred")
  date             DateTime     @db.Date
  createdAt        DateTime     @default(now()) @map("created_at")
  photographer     Photographer @relation(fields: [photographerId], references: [id], onDelete: Cascade)

  @@unique([photographerId, endpoint, date])
  @@map("api_usage")
}
